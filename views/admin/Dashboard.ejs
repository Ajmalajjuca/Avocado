<!DOCTYPE HTML>
<html lang="en">
  <%- include('partials/head.ejs') %>
  


<!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:32:35 GMT -->

<body>
    <%- include('partials/side.ejs') %>
    <main class="main-wrap">
        <%- include('partials/heder.ejs') %>
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                    <p>Whole data about your business here</p>
                </div>
                <div>
                    <a href="#" class="btn btn-primary" id="createReportBtn">
                        <i class="text-muted material-icons md-post_add"></i>Create report
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">TotalSales</h6>
                          <span>₹<%= totalSales %></span>
                          <span class="text-sm">Shipping fees are not included</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Orders</h6>
                          <span><%= orderCount %></span>
                          <span class="text-sm">Excluding orders in transit</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Products</h6>
                          <span><%= productCount %></span>
                          <span class="text-sm">In all categories</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Monthly Earning</h6>
                          <span>₹ <%= monthlyEarning %></span>
                          <span class="text-sm">Based on your local time.</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-person"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">No of Users</h6>
                          <span> <%= totalUser %></span>
                          <span class="text-sm">Based on your local time.</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-danger material-icons md-pending_actions"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Pending Order</h6>
                          <span> <%= pendingOrder %></span>
                          <span class="text-sm">Based on your local time.</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-add_task"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Completed Order</h6>
                          <span><%= ConfirmedOrder %></span>
                          <span class="text-sm">Based on your local time.</span>
                        </div>
                      </article>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="card card-body mb-4">
                      <article class="icontext">
                        <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-payments"></i></span>
                        <div class="text">
                          <h6 class="mb-1 card-title">Total Discount</h6>
                          <span>₹ <%= totalDiscount %></span>
                          <span class="text-sm">Based on your local time.</span>
                        </div>
                      </article>
                    </div>
                  </div>
            </div>
            <div class="row">
              <div class="col-xl-8 col-lg-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Sale statistics</h5>
                        <div class="mb-3">
                            <select id="salesFilter" class="form-select">
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        <div id="salesChart"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 col-lg-4 col-xl-4 order-0 mb-4">
              <div class="card h-100">
                <div class="card-header d-flex align-items-center justify-content-between pb-0">
                  <div class="card-title mb-0">
                    <h5 class="m-0 me-2">Order Statistics</h5>
                    <small class="text-muted">₹<%= totalSales %> Total Sales</small>
                  </div>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex flex-column align-items-center gap-1">
                      <h2 class="mb-2"><%= orderCount %></h2>
                      <span>Total Orders</span>
                    </div>
                    <div class="d-flex justify-content-center align-items-center mb-3">
                      <div id="orderStatisticsChart"></div>
                    </div>
                  </div>
                  <ul class="p-0 m-0">
                    <% topCategories.forEach((category, index) => { %>
                      <li class="d-flex mb-4 pb-1">
                        <div class="avatar flex-shrink-0 me-3">
                          <span class="avatar-initial rounded bg-label-<%= ['primary', 'success', 'info', 'secondary'][index % 4] %>">
                          </span>
                        </div>
                        <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                          <div class="me-2">
                            <h6 class="mb-0"><%= category.name %></h6>
                          </div>
                          <div class="user-progress">
                            <small class="fw-semibold">₹<%= category.revenue.toFixed(2) %></small>
                          </div>
                        </div>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
            </div>
          </div>

            <div class="row">
              <div class="col-xl-6 col-lg-12">
                  <div class="card mb-4">
                      <article class="card-body">
                          <h5 class="card-title">Top Selling Products</h5>
                          <table class="table table-hover">
                              <thead>
                                  <tr>
                                      <th>Product</th>
                                      <th>Sold</th>
                                      <th>Revenue</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <% topProducts.forEach(product => { %>
                                  <tr>
                                      <td><%= product.name %></td>
                                      <td><%= product.soldCount %></td>
                                      <td>₹<%= product.revenue %></td>
                                  </tr>
                                  <% }); %>
                              </tbody>
                          </table>
                      </article>
                  </div>
              </div>
              <div class="col-xl-6 col-lg-12">
                  <div class="card mb-4">
                      <article class="card-body">
                          <h5 class="card-title">Top Selling Categories</h5>
                          <table class="table table-hover">
                              <thead>
                                  <tr>
                                      <th>Category</th>
                                      <th>Products Sold</th>
                                      <th>Revenue</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <% topCategories.forEach(category => { %>
                                  <tr>
                                      <td><%= category.name %></td>
                                      <td><%= category.productsSold %></td>
                                      <td>₹<%= category.revenue %></td>
                                  </tr>
                                  <% }); %>
                              </tbody>
                          </table>
                      </article>
                  </div>
              </div>
          </div>
            
        </section> <!-- content-main end// -->
        
    </main>
    <%- include('partials/foot.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Report Modal -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportModalLabel">Generate Sales Report</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="reportForm">
            <div class="mb-3">
              <label for="reportType" class="form-label">Report Type</label>
              <select class="form-select" id="reportType">
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
                <option value="custom">Custom Date Range</option>
              </select>
            </div>
            <div id="customDateRange" style="display: none;">
              <div class="mb-3">
                <label for="startDate" class="form-label">Start Date</label>
                <input type="date" class="form-control" id="startDate">
              </div>
              <div class="mb-3">
                <label for="endDate" class="form-label">End Date</label>
                <input type="date" class="form-control" id="endDate">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="generateReport">Generate Report</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    $(document).ready(function() {
      // Show modal when "Create report" button is clicked
      $('#createReportBtn').click(function(e) {
        e.preventDefault();
        $('#reportModal').modal('show');
      });
    
      // Show/hide custom date range inputs based on report type selection
      $('#reportType').change(function() {
        if ($(this).val() === 'custom') {
          $('#customDateRange').show();
        } else {
          $('#customDateRange').hide();
        }
      });
    
      // Handle report generation
      $('#generateReport').click(function() {
        const reportType = $('#reportType').val();
        let startDate, endDate;
    
        if (reportType === 'custom') {
          startDate = $('#startDate').val();
          endDate = $('#endDate').val();
        }
    
        // Send AJAX request to generate report
        $.ajax({
          url: '/admin/generate-report',
          method: 'POST',
          data: {
            reportType: reportType,
            startDate: startDate,
            endDate: endDate
          },
          success: function(response) {
            // Handle successful report generation
            console.log('Report generated:', response);
            if (response.success) {
        window.location.href = '/admin/report';
      } else {
        alert('Error generating report. Please try again.');
      }
            // You can show a success message or redirect to the report page
            alert('Report generated successfully!');
            $('#reportModal').modal('hide');
          },
          error: function(error) {
            // Handle error
            console.error('Error generating report:', error);
            alert('Error generating report. Please try again.');
          }
        });
      });
    });


    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        var chartElement = document.querySelector("#orderStatisticsChart");
        
        if (chartElement) {
          var options = {
            series: <%- JSON.stringify(topCategories.map(c => c.productsSold)) %>,
            chart: {
              width: 200,  // Decreased from 380
              type: 'donut',
              sparkline: {
                enabled: true  // This removes the grid and only shows the donut
              }
            },
            labels: <%- JSON.stringify(topCategories.map(c => c.name)) %>,
            colors: ['#696cff', '#71dd37', '#03c3ec', '#ffab00'],  // Custom colors
            dataLabels: {
              enabled: false  // This removes the labels from the donut slices
            },
            legend: {
              show: false  // This removes the legend
            },
            plotOptions: {
              pie: {
                donut: {
                  size: '70%',  // This makes the donut thinner
                  labels: {
                    show: true,
                    name: {
                      show: false
                    },
                    value: {
                      show: true,
                      fontSize: '2rem',
                      fontFamily: 'Public Sans',
                      color: '#566a7f',
                      offsetY: 5,
                      formatter: function (val) {
                        return parseInt(val);
                      }
                    },
                    total: {
                      show: true,
                      label: 'Total',
                      color: '#566a7f',
                      formatter: function (w) {
                        return w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                      }
                    }
                  }
                }
              }
            },
            responsive: [{
              breakpoint: 480,
              options: {
                chart: {
                  width: 200
                }
              }
            }]
          };
     
          var chart = new ApexCharts(chartElement, options);
          chart.render();
        } else {
          console.error("Chart container not found");
        }
      });
    </script>

<script>
let salesChart;

function updateChart(period) {
    fetch(`/admin/sales-data?period=${period}`)
        .then(response => response.json())
        .then(data => {
            const options = {
                series: [{
                    name: 'Sales',
                    data: data.sales
                }],
                chart: {
                    height: 350,
                    type: 'area',
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth'
                },
                xaxis: {
                    type: 'datetime',
                    categories: data.labels
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yy'
                    },
                },
                colors: ['#008FFB', '#00E396'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.9,
                        stops: [0, 100]
                    }
                }
            };

            if (salesChart) {
                salesChart.updateOptions(options);
            } else {
                salesChart = new ApexCharts(document.querySelector("#salesChart"), options);
                salesChart.render();
            }
        });
}

document.getElementById('salesFilter').addEventListener('change', function() {
    updateChart(this.value);
});

// Initial chart load
updateChart('monthly');
</script>
</body>


</html>